{% comment %}
    Used once per section. Contained by subparts at the top level.
{% endcomment %}
{% load string_formatters %}
{% load get_item %}

<section aria-labelledby="{{ node.label | join:'-' }}-title" tabindex="-1" id="{{node.label | join:'-'}}" class="reg-section">
    <h2 class="section-title" id="{{ node.label | join:'-' }}-title">
        {% section_formatter cfr_title node.label as formatted_citation %}
        <tooltip-container
            btn-type="icon"
            btn-class="copy-btn"
            title="{{node.label | join:'.'}}"
            label="Copy Link or Citation"
            button-icon="link"
            tooltip-title="{{formatted_citation}}"
            position="over"
            hover
            click
        >
            <template #tooltip-content>
                <div class="action-btns">
                    <copy-citation
                        hash="{{node.label | join:'-'}}"
                        formatted-citation="{{formatted_citation}}"
                    ></copy-citation>
                </div>
            </template>
        </tooltip-container>
        {{node.title}}
    </h2>

    {% simple_section_formatter cfr_title node.label as simple_citation %}
    {% if node.label|length <= 2 %}
    {{ node.label| join:'.' }}
        <div class="section-info-row section-info-row--top">
            <div class="info-links">
                <view-resources-link type="button" section="ยง {{node.label | join:'.'}}" count="{% get_item resource_count simple_citation '0' %}"></view-resources-link>
            <scroll-trigger-link trigger="{{ node.label | join:'.'}}" />
            </div>
        </div>
    {% endif %}

    <div class="paragraphs">
        {{node.text | safe}}

        {% for node in node.children %}
            {% include "regulations/partials/node_types/node.html" %}
        {% endfor %}
    </div>

    {% if node.label|length <= 2 %}
        <div class="section-info-row section-info-row--bottom" data-scroll-target="{{node.label | join:'.'}}">
            <div class="info-links">
                <view-resources-link type="button" section="ยง {{node.label | join:'.'}}" count="{% get_item resource_count simple_citation '0' %}"></view-resources-link>
                <scroll-target-container
                    trigger="{{ node.label | join:'.'}}"
                >
                    <collapse-button
                        name="{{node.label | join:'.'}} section history"
                        state="collapsed"
                    >
                        <template #expanded>
                            View ยง {{ node.label | join:'.' }} Version History
                            <i class="fa fa-chevron-up" />
                        </template>
                        <template #collapsed>
                            View ยง {{ node.label | join:'.' }} Version History
                            <i class="fa fa-chevron-down" />
                        </template>
                    </collapse-button>
                </scroll-target-container>
            </div>
        </div>
        <collapsible
            name="{{node.label | join:'.'}} section history"
            class="collapse-content"
            state="collapsed"
        > Hi </collapsible>
    {% endif %}

</section>
