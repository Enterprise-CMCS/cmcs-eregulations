service: cmcs-eregs-parser

provider:
  name: aws
  runtime: go1.x
  region: us-east-1
  environment:
    HTTP_AUTH_USER: ${ssm:/eregulations/http/user~true}
    HTTP_AUTH_PASSWORD: ${ssm:/eregulations/http/password~true}
    TITLE: ${ssm:/eregulations/parser/title}
    SUBCHAPTER: ${ssm:/eregulations/parser/subchapter}
    PARTS: ${ssm:/eregulations/parser/parts}
    EREGS_URL: ${self:custom.settings.eregs_url}
    WORKERS: ${ssm:/eregulations/parser/workers}
    ATTEMPTS: ${ssm:/eregulations/parser/attempts}
    LOGLEVEL: ${ssm:/eregulations/parser/loglevel}
    LOG_PARSE_ERRORS: ${ssm:/eregulations/parser/log_parse_errors}

custom:
  stage: ${opt:stage, self:provider.stage}
  settings:
    eregs_url: ${cf:cmcs-eregs-site-${self:custom.stage}.ServiceEndpoint}/v2/

functions:
  ecfr_parser:
    handler: ../tools/ecfr-parser/main.go
    timeout: 900

plugins:
  - serverless-go-plugin
